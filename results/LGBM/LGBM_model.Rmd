---
title: "XGB model details"
author: "Adithi R. Upadhya"
date: "09/10/2021"
output: html_document
---

# lgbm_grid

```{r echo = FALSE, eval = FALSE}
H2O Grid Details
================

Grid ID: lightgbm_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 5 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing residual_deviance
   booster col_sample_rate col_sample_rate_per_tree distribution   eta gamma
1     dart             0.9                     0.68        gamma  0.05   0.1
2   gbtree             0.5                     0.77     gaussian   0.1   0.7
3     dart            0.75                     0.63     gaussian 0.025   0.9
4 gblinear             0.8                     0.74      poisson   0.3   0.1
5     dart            0.67                     0.95      poisson   0.1   0.5
  grow_policy max_depth min_child_weight min_rows min_split_improvement ntrees
1   lossguide        12              2.0      2.0                   0.1    500
2   lossguide        16              3.0      3.0                   0.7    799
3   lossguide        16           2048.0   2048.0                   0.9   1000
4   lossguide         4              2.0      2.0                   0.1   1000
5   lossguide        16              2.0      2.0                   0.5    500
  reg_alpha reg_lambda sample_rate tree_method             model_ids
1       0.1        1.0        0.81        hist lightgbm_grid_model_2
2       0.1        0.0         0.6        hist lightgbm_grid_model_5
3       0.1      0.001        0.61        hist lightgbm_grid_model_1
4       0.1        0.0        0.51        hist lightgbm_grid_model_3
5     0.001        0.1         0.8        hist lightgbm_grid_model_4
   residual_deviance
1 10.814575827628905
2  417.2456966239993
3 3608.7023910554904
4                NaN
5                NaN
```

# grid_perf

```{r echo = FALSE, eval = FALSE}
H2O Grid Details
================

Grid ID: lightgbm_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 5 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing mse
   booster col_sample_rate col_sample_rate_per_tree distribution   eta gamma
1   gbtree             0.5                     0.77     gaussian   0.1   0.7
2     dart             0.9                     0.68        gamma  0.05   0.1
3     dart            0.75                     0.63     gaussian 0.025   0.9
4 gblinear             0.8                     0.74      poisson   0.3   0.1
5     dart            0.67                     0.95      poisson   0.1   0.5
  grow_policy max_depth min_child_weight min_rows min_split_improvement ntrees
1   lossguide        16              3.0      3.0                   0.7    799
2   lossguide        12              2.0      2.0                   0.1    500
3   lossguide        16           2048.0   2048.0                   0.9   1000
4   lossguide         4              2.0      2.0                   0.1   1000
5   lossguide        16              2.0      2.0                   0.5    500
  reg_alpha reg_lambda sample_rate tree_method             model_ids
1       0.1        0.0         0.6        hist lightgbm_grid_model_5
2       0.1        1.0        0.81        hist lightgbm_grid_model_2
3       0.1      0.001        0.61        hist lightgbm_grid_model_1
4       0.1        0.0        0.51        hist lightgbm_grid_model_3
5     0.001        0.1         0.8        hist lightgbm_grid_model_4
                 mse
1  417.2456966239993
2  431.3453847741396
3 3608.7023910554904
4                NaN
5                NaN

---
    booster col_sample_rate col_sample_rate_per_tree colsample_bytree
42   gbtree            0.48                     0.96             0.96
43   gbtree            0.81                     0.88             0.88
44   gbtree            0.81                     0.88             0.88
45   gbtree            0.27                      0.9              0.9
46 gblinear             0.8                     0.74             0.74
47     dart            0.67                     0.95             0.95
   distribution   eta  gamma grow_policy learn_rate max_depth min_child_weight
42     gaussian  0.05    0.7   depthwise       0.05         8              2.0
43        gamma  0.05 1.0E-4   depthwise       0.05        16              8.0
44        gamma  0.05 1.0E-4   depthwise       0.05        16              8.0
45        gamma 0.025   0.05   lossguide      0.025         8            256.0
46      poisson   0.3    0.1   depthwise        0.3         4              2.0
47      poisson   0.1    0.5   depthwise        0.1        16              2.0
   min_rows min_split_improvement ntrees reg_alpha reg_lambda sample_rate
42      2.0                   0.7      1       0.1        1.0        0.85
43      8.0                1.0E-4      1       0.1      0.001        0.76
44      8.0                1.0E-4      1       0.1      0.001        0.76
45    256.0                  0.05      1    1.0E-4        0.1        0.53
46      2.0                   0.1   1000       0.1        0.0        0.51
47      2.0                   0.5    500     0.001        0.1         0.8
   subsample tree_method         model_ids                mse
42      0.85       exact xgb_grid_model_13 16447.551263547546
43      0.76       exact xgb_grid_model_26 18013.583071072826
44      0.76       exact xgb_grid_model_26 18013.583071072826
45      0.53        hist xgb_grid_model_38 18014.053579664185
46      0.51      approx xgb_grid_model_43                NaN
47       0.8      approx xgb_grid_model_44                NaN
```

# best_model

```{r  echo = FALSE, eval = FALSE}
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5 
Model Summary: 
  number_of_trees
1             799


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.3222913
RMSE:  0.5677071
MAE:  0.4329002
RMSLE:  0.01076383
Mean Residual Deviance :  0.3222913



H2ORegressionMetrics: xgboost
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  417.2457
RMSE:  20.42659
MAE:  12.77777
RMSLE:  0.1735836
Mean Residual Deviance :  417.2457


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid
mae                     12.775928  0.280976  12.390013  12.969201  12.818295
mean_residual_deviance 416.971950 25.182394 396.604980 444.433930 401.124700
mse                    416.971950 25.182394 396.604980 444.433930 401.124700
r2                       0.938519  0.005213   0.944697   0.933270   0.937013
residual_deviance      416.971950 25.182394 396.604980 444.433930 401.124700
rmse                    20.411660  0.611142  19.914944  21.081602  20.028097
rmsle                    0.173417  0.006344   0.167059   0.179778   0.183412
                       cv_4_valid cv_5_valid cv_6_valid cv_7_valid cv_8_valid
mae                     12.364052  12.682013  12.670563  13.073964  13.022728
mean_residual_deviance 398.499540 412.209630 425.891200 394.907560 464.022520
mse                    398.499540 412.209630 425.891200 394.907560 464.022520
r2                       0.939193   0.938089   0.942938   0.942526   0.927149
residual_deviance      398.499540 412.209630 425.891200 394.907560 464.022520
rmse                    19.962454  20.302946  20.637130  19.872280  21.541182
rmsle                    0.171272   0.165177   0.168153   0.171855   0.181818
                       cv_9_valid cv_10_valid
mae                     13.166793   12.601655
mean_residual_deviance 439.901760  392.123700
mse                    439.901760  392.123700
r2                       0.938469    0.941845
residual_deviance      439.901760  392.123700
rmse                    20.973835   19.802113
rmsle                    0.170880    0.174766
```


# h2o.scoreHistory(best_model)

```{r echo = FALSE, eval = FALSE}
Scoring History: 
            timestamp     duration number_of_trees training_rmse training_mae
1 2021-10-09 12:44:51  1:52:55.756               0     134.23481    105.85576
2 2021-10-09 12:44:51  1:52:56.236              10      50.61552     37.16599
3 2021-10-09 12:44:52  1:52:56.495              20      22.60701     14.75822
4 2021-10-09 12:44:52  1:52:56.703              30      13.39046      8.59065
5 2021-10-09 12:44:52  1:52:56.861              40      10.29406      6.74879
  training_deviance
1       18018.98359
2        2561.93103
3         511.07702
4         179.30438
5         105.96771

---
             timestamp     duration number_of_trees training_rmse training_mae
76 2021-10-09 12:45:07  1:53:11.834             750       0.66300      0.50235
77 2021-10-09 12:45:07  1:53:12.174             760       0.64258      0.48744
78 2021-10-09 12:45:08  1:53:12.532             770       0.62059      0.47124
79 2021-10-09 12:45:08  1:53:12.892             780       0.60216      0.45755
80 2021-10-09 12:45:08  1:53:13.267             790       0.58032      0.44218
81 2021-10-09 12:45:09  1:53:13.621             799       0.56771      0.43290
   training_deviance
76           0.43957
77           0.41291
78           0.38514
79           0.36259
80           0.33677
81           0.32229
```

# cv_models

```{r echo = FALSE, eval = FALSE}
[1]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_1 
Model Summary: 
  number_of_trees
1             621


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.8133845
RMSE:  0.9018783
MAE:  0.6778925
RMSLE:  0.01650618
Mean Residual Deviance :  0.8133845


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  396.605
RMSE:  19.91494
MAE:  12.39001
RMSLE:  0.1670588
Mean Residual Deviance :  396.605




[[2]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_2 
Model Summary: 
  number_of_trees
1             621


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.6793206
RMSE:  0.8242091
MAE:  0.6193624
RMSLE:  0.01506693
Mean Residual Deviance :  0.6793206


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  444.4339
RMSE:  21.0816
MAE:  12.9692
RMSLE:  0.1797784
Mean Residual Deviance :  444.4339




[[3]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_3 
Model Summary: 
  number_of_trees
1             621


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.7901612
RMSE:  0.8889101
MAE:  0.6623246
RMSLE:  0.01599209
Mean Residual Deviance :  0.7901612


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  401.1247
RMSE:  20.0281
MAE:  12.8183
RMSLE:  0.1834122
Mean Residual Deviance :  401.1247




[[4]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_4 
Model Summary: 
  number_of_trees
1             630


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.7289928
RMSE:  0.8538108
MAE:  0.6455606
RMSLE:  0.0152868
Mean Residual Deviance :  0.7289928


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  398.4995
RMSE:  19.96245
MAE:  12.36405
RMSLE:  0.1712724
Mean Residual Deviance :  398.4995




[[5]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_5 
Model Summary: 
  number_of_trees
1             631


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.82337
RMSE:  0.9073974
MAE:  0.6780735
RMSLE:  0.01624415
Mean Residual Deviance :  0.82337


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  412.2096
RMSE:  20.30295
MAE:  12.68201
RMSLE:  0.165177
Mean Residual Deviance :  412.2096




[[6]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_6 
Model Summary: 
  number_of_trees
1             623


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.7248869
RMSE:  0.8514029
MAE:  0.6406711
RMSLE:  0.01528761
Mean Residual Deviance :  0.7248869


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  425.8912
RMSE:  20.63713
MAE:  12.67056
RMSLE:  0.1681528
Mean Residual Deviance :  425.8912




[[7]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_7 
Model Summary: 
  number_of_trees
1             631


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.8515789
RMSE:  0.9228104
MAE:  0.6869456
RMSLE:  0.01714824
Mean Residual Deviance :  0.8515789


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  394.9076
RMSE:  19.87228
MAE:  13.07396
RMSLE:  0.1718553
Mean Residual Deviance :  394.9076




[[8]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_8 
Model Summary: 
  number_of_trees
1             621


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.8724059
RMSE:  0.9340267
MAE:  0.6959155
RMSLE:  0.0170804
Mean Residual Deviance :  0.8724059


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  464.0225
RMSE:  21.54118
MAE:  13.02273
RMSLE:  0.1818178
Mean Residual Deviance :  464.0225




[[9]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_9 
Model Summary: 
  number_of_trees
1            1500


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.09328212
RMSE:  0.3054212
MAE:  0.2445233
RMSLE:  0.006101306
Mean Residual Deviance :  0.09328212


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  439.9018
RMSE:  20.97384
MAE:  13.16679
RMSLE:  0.1708804
Mean Residual Deviance :  439.9018




[[10]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lightgbm_grid_model_5_cv_10 
Model Summary: 
  number_of_trees
1            1500


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  0.09184361
RMSE:  0.3030571
MAE:  0.2422451
RMSLE:  0.005960706
Mean Residual Deviance :  0.09184361


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  392.1237
RMSE:  19.80211
MAE:  12.60165
RMSLE:  0.1747658
Mean Residual Deviance :  392.1237

```

# best_model_perf using test data 

```{r echo = FALSE, eval = FALSE}
H2ORegressionMetrics: xgboost

MSE:  448.3616
RMSE:  21.17455
MAE:  13.11365
RMSLE:  0.1759853
Mean Residual Deviance :  448.3616
```

# h2o.mse(best_model_perf) %>% sqrt()

```{r echo = FALSE, eval = FALSE}
21.17
```
