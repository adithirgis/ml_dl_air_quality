---
title: "DRF model details"
author: "Adithi R. Upadhya"
date: "07/10/2021"
output: html_document
---

# rf_grid

```{r echo = FALSE, eval = FALSE}
H2O Grid Details
================

Grid ID: rf_grid 
Used hyper parameters: 
  -  max_depth 
  -  min_rows 
  -  mtries 
  -  nbins 
  -  ntrees 
  -  sample_rate 
Number of models: 35 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing residual_deviance
  max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids
1  30.00000  3.00000 6.00000 30.00000 200.00000     0.75000 rf_grid_model_27
2  30.00000  3.00000 6.00000 30.00000 350.00000     0.75000 rf_grid_model_28
3  30.00000  3.00000 6.00000 30.00000 350.00000     0.63200 rf_grid_model_20
4  30.00000  6.00000 6.00000 30.00000 320.00000     0.75000 rf_grid_model_37
5  30.00000  6.00000 6.00000 10.00000 350.00000     0.80000 rf_grid_model_16
  residual_deviance
1         336.33995
2         336.62995
3         341.66804
4         343.70334
5         343.72030

---
   max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids
30  10.00000  3.00000 1.00000 10.00000 200.00000     0.80000 rf_grid_model_38
31  10.00000  3.00000 1.00000 30.00000 200.00000     0.55000 rf_grid_model_26
32  10.00000  6.00000 1.00000 30.00000 200.00000     0.75000 rf_grid_model_11
33  10.00000  6.00000 1.00000 30.00000 200.00000     0.55000 rf_grid_model_35
34  10.00000  6.00000 1.00000 10.00000  31.00000     0.80000  rf_grid_model_4
35  10.00000  3.00000 1.00000 10.00000   7.00000     0.63200  rf_grid_model_5
   residual_deviance
30         894.57466
31         894.74339
32         896.18602
33         965.98134
34        1004.48327
35        1027.87913
```

# grid_perf

```{r echo = FALSE, eval = FALSE}
> print(grid_perf)
H2O Grid Details
================

Grid ID: rf_grid 
Used hyper parameters: 
  -  max_depth 
  -  min_rows 
  -  mtries 
  -  nbins 
  -  ntrees 
  -  sample_rate 
Number of models: 35 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing mse
  max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids       mse
1  30.00000  3.00000 6.00000 30.00000 200.00000     0.75000 rf_grid_model_27 336.33995
2  30.00000  3.00000 6.00000 30.00000 350.00000     0.75000 rf_grid_model_28 336.62995
3  30.00000  3.00000 6.00000 30.00000 350.00000     0.63200 rf_grid_model_20 341.66804
4  30.00000  6.00000 6.00000 30.00000 320.00000     0.75000 rf_grid_model_37 343.70334
5  30.00000  6.00000 6.00000 10.00000 350.00000     0.80000 rf_grid_model_16 343.72030

---
   max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids
30  10.00000  3.00000 1.00000 10.00000 200.00000     0.80000 rf_grid_model_38
31  10.00000  3.00000 1.00000 30.00000 200.00000     0.55000 rf_grid_model_26
32  10.00000  6.00000 1.00000 30.00000 200.00000     0.75000 rf_grid_model_11
33  10.00000  6.00000 1.00000 30.00000 200.00000     0.55000 rf_grid_model_35
34  10.00000  6.00000 1.00000 10.00000  31.00000     0.80000  rf_grid_model_4
35  10.00000  3.00000 1.00000 10.00000   7.00000     0.63200  rf_grid_model_5
          mse
30  894.57466
31  894.74339
32  896.18602
33  965.98134
34 1004.48327
35 1027.87913

```


# best_model

```{r echo = FALSE, eval = FALSE}
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7812635        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.79000       1493       1871  1838.34500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  333.0757
RMSE:  18.25036
MAE:  11.48815
RMSLE:  0.1573973
Mean Residual Deviance :  333.0757



H2ORegressionMetrics: drf
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  336.3399
RMSE:  18.33957
MAE:  11.574
RMSLE:  0.1577464
Mean Residual Deviance :  336.3399


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     11.585153  0.662726  11.487800  12.218972  10.895914  11.316600
mean_residual_deviance 337.258420 51.189964 329.084700 348.154850 311.185200 325.810120
mse                    337.258420 51.189964 329.084700 348.154850 311.185200 325.810120
r2                       0.950525  0.006150   0.949885   0.951798   0.954247   0.953502
residual_deviance      337.258420 51.189964 329.084700 348.154850 311.185200 325.810120
rmse                    18.318802  1.366217  18.140692  18.658907  17.640442  18.050210
rmsle                    0.157771  0.005071   0.155792   0.158362   0.151181   0.150171
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     11.405988  11.250754  12.829166  12.153010  10.600779
mean_residual_deviance 323.338840 312.290000 453.565500 343.860900 253.538020
mse                    323.338840 312.290000 453.565500 343.860900 253.538020
r2                       0.950342   0.955443   0.936573   0.950661   0.958300
residual_deviance      323.338840 312.290000 453.565500 343.860900 253.538020
rmse                    17.981625  17.671730  21.297077  18.543486  15.922877
rmsle                    0.160090   0.155590   0.161870   0.167631   0.159119
                       cv_10_valid
mae                      11.692543
mean_residual_deviance  371.756040
mse                     371.756040
r2                        0.944498
residual_deviance       371.756040
rmse                     19.280975
rmsle                     0.157900

```

# h2o.scoreHistory(best_model)

```{r echo = FALSE, eval = FALSE}
Scoring History: 
            timestamp          duration number_of_trees training_rmse training_mae
1 2021-11-28 23:02:20  8 min 52.875 sec               0            NA           NA
2 2021-11-28 23:02:20  8 min 52.921 sec               1      29.23706     17.94127
3 2021-11-28 23:02:20  8 min 52.971 sec               2      27.35603     16.88506
4 2021-11-28 23:02:20  8 min 53.017 sec               3      26.79764     16.59826
5 2021-11-28 23:02:20  8 min 53.061 sec               4      25.52027     16.01074
  training_deviance
1                NA
2         854.80593
3         748.35245
4         718.11366
5         651.28413

---
             timestamp          duration number_of_trees training_rmse training_mae
82 2021-11-28 23:02:24  8 min 56.722 sec              81      18.59684     11.68294
83 2021-11-28 23:02:24  8 min 56.772 sec              82      18.57387     11.67167
84 2021-11-28 23:02:24  8 min 56.820 sec              83      18.57844     11.66851
85 2021-11-28 23:02:24  8 min 56.867 sec              84      18.56012     11.66194
86 2021-11-28 23:02:28  9 min  0.909 sec             172      18.28709     11.51912
87 2021-11-28 23:02:30  9 min  2.221 sec             200      18.25036     11.48815
   training_deviance
82         345.84262
83         344.98855
84         345.15861
85         344.47820
86         334.41750
87         333.07573
```

# cv_models

```{r echo = FALSE, eval = FALSE}
[[1]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_1 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7163665        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.29000       1378       1696  1659.33500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  343.0879
RMSE:  18.52263
MAE:  11.67429
RMSLE:  0.1594423
Mean Residual Deviance :  343.0879


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  329.0847
RMSE:  18.14069
MAE:  11.4878
RMSLE:  0.1557919
Mean Residual Deviance :  329.0847




[[2]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_2 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7145096        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.45000       1585       1682  1652.76000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  336.805
RMSE:  18.35225
MAE:  11.53303
RMSLE:  0.1584359
Mean Residual Deviance :  336.805


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  348.1548
RMSE:  18.65891
MAE:  12.21897
RMSLE:  0.1583623
Mean Residual Deviance :  348.1548




[[3]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_3 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7133960        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.39000       1604       1678  1650.15000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  343.0033
RMSE:  18.52035
MAE:  11.72236
RMSLE:  0.1589876
Mean Residual Deviance :  343.0033


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  311.1852
RMSE:  17.64044
MAE:  10.89591
RMSLE:  0.1511808
Mean Residual Deviance :  311.1852




[[4]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_4 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7147159        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.50500       1603       1690  1657.32500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  344.9302
RMSE:  18.5723
MAE:  11.69109
RMSLE:  0.1596037
Mean Residual Deviance :  344.9302


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  325.8101
RMSE:  18.05021
MAE:  11.3166
RMSLE:  0.1501714
Mean Residual Deviance :  325.8101




[[5]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_5 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7219355        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.35000       1382       1709  1672.19000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  338.4572
RMSE:  18.3972
MAE:  11.65003
RMSLE:  0.1583613
Mean Residual Deviance :  338.4572


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  323.3389
RMSE:  17.98163
MAE:  11.40599
RMSLE:  0.1600896
Mean Residual Deviance :  323.3389




[[6]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_6 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7086053        18        25
  mean_depth min_leaves max_leaves mean_leaves
1   20.45500       1601       1678  1642.49500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  347.1607
RMSE:  18.63225
MAE:  11.76354
RMSLE:  0.1602272
Mean Residual Deviance :  347.1607


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  312.29
RMSE:  17.67173
MAE:  11.25075
RMSLE:  0.1555898
Mean Residual Deviance :  312.29




[[7]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_7 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7165138        18        25
  mean_depth min_leaves max_leaves mean_leaves
1   20.58000       1615       1688  1662.01500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  323.5327
RMSE:  17.98701
MAE:  11.49894
RMSLE:  0.1588542
Mean Residual Deviance :  323.5327


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  453.5655
RMSE:  21.29708
MAE:  12.82917
RMSLE:  0.1618701
Mean Residual Deviance :  453.5655




[[8]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_8 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7162384        18        26
  mean_depth min_leaves max_leaves mean_leaves
1   20.48000       1614       1698  1662.39500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  339.3145
RMSE:  18.42049
MAE:  11.58157
RMSLE:  0.1586446
Mean Residual Deviance :  339.3145


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  343.8609
RMSE:  18.54349
MAE:  12.15301
RMSLE:  0.1676314
Mean Residual Deviance :  343.8609




[[9]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_9 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7125591        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.22000       1497       1689  1651.28500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  352.532
RMSE:  18.77584
MAE:  11.77362
RMSLE:  0.159297
Mean Residual Deviance :  352.532


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  253.538
RMSE:  15.92288
MAE:  10.60078
RMSLE:  0.1591193
Mean Residual Deviance :  253.538




[[10]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_27_cv_10 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             200                      200             7212509        18        24
  mean_depth min_leaves max_leaves mean_leaves
1   20.34000       1638       1699  1668.98000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  331.3787
RMSE:  18.20381
MAE:  11.56732
RMSLE:  0.1584911
Mean Residual Deviance :  331.3787


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  371.756
RMSE:  19.28098
MAE:  11.69254
RMSLE:  0.1578998
Mean Residual Deviance :  371.756

```


# best_model_perf using test data 

```{r echo = FALSE, eval = FALSE}
H2ORegressionMetrics: drf

MSE:  343.4516
RMSE:  18.53245
MAE:  11.6413
RMSLE:  0.1584026
Mean Residual Deviance :  343.4516
```

# h2o.mse(best_model_perf) %>% sqrt()

```{r echo = FALSE, eval = FALSE}
18.53
```


# model_drf

```{r echo = FALSE, eval = FALSE}
Model Details:
==============

H2ORegressionModel: drf
Model ID:  DRF_model_R_1638096350565_3 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             100                      100             3909147        19        25
  mean_depth min_leaves max_leaves mean_leaves
1   20.86000       1814       1868  1842.39000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  336.4296
RMSE:  18.34202
MAE:  11.56481
RMSLE:  0.158673
Mean Residual Deviance :  336.4296



H2ORegressionMetrics: drf
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  339.8518
RMSE:  18.43507
MAE:  11.61342
RMSLE:  0.1590003
Mean Residual Deviance :  339.8518


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     11.615125  0.385933  11.537180  12.154280  11.083929  11.381344
mean_residual_deviance 339.693450 37.168312 307.893700 362.819300 293.725340 330.371400
mse                    339.693450 37.168312 307.893700 362.819300 293.725340 330.371400
r2                       0.950007  0.006268   0.951124   0.950287   0.954923   0.954544
residual_deviance      339.693450 37.168312 307.893700 362.819300 293.725340 330.371400
rmse                    18.406538  0.996007  17.546900  19.047817  17.138416  18.176123
rmsle                    0.158913  0.005102   0.154359   0.159888   0.153713   0.159192
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     10.972509  11.529301  11.815760  11.864606  11.820478
mean_residual_deviance 303.460050 318.930760 378.526520 335.093700 354.304020
mse                    303.460050 318.930760 378.526520 335.093700 354.304020
r2                       0.953953   0.954307   0.943941   0.951724   0.950534
residual_deviance      303.460050 318.930760 378.526520 335.093700 354.304020
rmse                    17.420105  17.858633  19.455757  18.305565  18.822966
rmsle                    0.151785   0.161574   0.161778   0.162082   0.155852
                       cv_10_valid
mae                      11.991862
mean_residual_deviance  411.809800
mse                     411.809800
r2                        0.934730
residual_deviance       411.809800
rmse                     20.293098
rmsle                     0.168910
```

# variable importance for model_drf

```{r eval = FALSE, echo = FALSE}
Variable Importances: 
       variable relative_importance scaled_importance percentage
1           day   3294741760.000000          1.000000   0.635724
2         Press    670332032.000000          0.203455   0.129341
3           BLH    422205632.000000          0.128145   0.081465
4  Station_code    258322128.000000          0.078404   0.049844
5          Temp    153275760.000000          0.046521   0.029575
6        season    101415008.000000          0.030781   0.019568
7           AOD     57118080.000000          0.017336   0.011021
8            WS     52426168.000000          0.015912   0.010116
9            RH     51792788.000000          0.015720   0.009993
10         NDVI     48474964.000000          0.014713   0.009353
11          CWV     35458916.000000          0.010762   0.006842
12           WD     19889524.000000          0.006037   0.003838
13          ELV     17206928.000000          0.005223   0.003320
```
