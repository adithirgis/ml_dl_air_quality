---
title: "DRF"
author: "Adithi R Upadhya"
date: "04/12/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## random_grid

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: rf_grid 
Used hyper parameters: 
  -  max_depth 
  -  min_rows 
  -  mtries 
  -  nbins 
  -  ntrees 
  -  sample_rate 
Number of models: 128 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing residual_deviance
  max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids
1  30.00000  5.00000 6.00000 10.00000 400.00000     0.80000 rf_grid_model_66
2  10.00000  5.00000 6.00000 10.00000 200.00000     0.80000 rf_grid_model_76
3  10.00000  5.00000 6.00000 30.00000 200.00000     0.80000 rf_grid_model_44
4  30.00000  5.00000 6.00000 10.00000 400.00000     0.75000 rf_grid_model_49
5  10.00000  5.00000 6.00000 30.00000 400.00000     0.80000 rf_grid_model_65
  residual_deviance
1         436.87316
2         437.64162
3         442.76307
4         443.80175
5         445.19813

---
    max_depth min_rows  mtries    nbins    ntrees sample_rate         model_ids
123  10.00000 10.00000 2.00000 30.00000 400.00000     0.55000 rf_grid_model_118
124  30.00000 10.00000 2.00000 30.00000 400.00000     0.55000  rf_grid_model_48
125  30.00000 10.00000 2.00000 10.00000 400.00000     0.55000  rf_grid_model_19
126  10.00000 10.00000 2.00000 10.00000 400.00000     0.55000 rf_grid_model_101
127  10.00000 10.00000 2.00000 10.00000 200.00000     0.55000  rf_grid_model_98
128  10.00000 10.00000 2.00000 30.00000 200.00000     0.55000  rf_grid_model_30
    residual_deviance
123         735.26529
124         742.51637
125         746.53821
126         754.41658
127         757.77590
128         760.27907
```

## print(grid_perf)

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: rf_grid 
Used hyper parameters: 
  -  max_depth 
  -  min_rows 
  -  mtries 
  -  nbins 
  -  ntrees 
  -  sample_rate 
Number of models: 128 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing mse
  max_depth min_rows  mtries    nbins    ntrees sample_rate        model_ids       mse
1  30.00000  5.00000 6.00000 10.00000 400.00000     0.80000 rf_grid_model_66 436.87316
2  10.00000  5.00000 6.00000 10.00000 200.00000     0.80000 rf_grid_model_76 437.64162
3  10.00000  5.00000 6.00000 30.00000 200.00000     0.80000 rf_grid_model_44 442.76307
4  30.00000  5.00000 6.00000 10.00000 400.00000     0.75000 rf_grid_model_49 443.80175
5  10.00000  5.00000 6.00000 30.00000 400.00000     0.80000 rf_grid_model_65 445.19813

---
    max_depth min_rows  mtries    nbins    ntrees sample_rate         model_ids
123  10.00000 10.00000 2.00000 30.00000 400.00000     0.55000 rf_grid_model_118
124  30.00000 10.00000 2.00000 30.00000 400.00000     0.55000  rf_grid_model_48
125  30.00000 10.00000 2.00000 10.00000 400.00000     0.55000  rf_grid_model_19
126  10.00000 10.00000 2.00000 10.00000 400.00000     0.55000 rf_grid_model_101
127  10.00000 10.00000 2.00000 10.00000 200.00000     0.55000  rf_grid_model_98
128  10.00000 10.00000 2.00000 30.00000 200.00000     0.55000  rf_grid_model_30
          mse
123 735.26529
124 742.51637
125 746.53821
126 754.41658
127 757.77590
128 760.27907
```

## best_model

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             4252229        13        20
  mean_depth min_leaves max_leaves mean_leaves
1   15.84500        476        510   493.10000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  411.8951
RMSE:  20.2952
MAE:  13.41614
RMSLE:  0.1617442
Mean Residual Deviance :  411.8951



H2ORegressionMetrics: drf
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  436.8732
RMSE:  20.90151
MAE:  13.64133
RMSLE:  0.1646859
Mean Residual Deviance :  436.8732


Cross-Validation Metrics Summary: 
                             mean         sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     13.659342   0.802096  13.472185  12.664132  13.930799  12.975607
mean_residual_deviance 439.011800 102.897410 368.203770 308.295840 478.571700 449.219180
mse                    439.011800 102.897410 368.203770 308.295840 478.571700 449.219180
r2                       0.924416   0.018163   0.939348   0.945561   0.918808   0.899059
residual_deviance      439.011800 102.897410 368.203770 308.295840 478.571700 449.219180
rmse                    20.831734   2.368939  19.188637  17.558355  21.876282  21.194792
rmsle                    0.164691   0.012148   0.162677   0.144800   0.169385   0.172299
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     12.530697  13.449480  15.041902  14.499922  14.147729
mean_residual_deviance 332.532560 410.558400 499.052200 675.022100 437.818400
mse                    332.532560 410.558400 499.052200 675.022100 437.818400
r2                       0.940691   0.933868   0.926056   0.889011   0.928096
residual_deviance      332.532560 410.558400 499.052200 675.022100 437.818400
rmse                    18.235476  20.262241  22.339476  25.981188  20.924110
rmsle                    0.153228   0.153647   0.163570   0.187845   0.167875
                       cv_10_valid
mae                      13.880964
mean_residual_deviance  430.844000
mse                     430.844000
r2                        0.923664
residual_deviance       430.844000
rmse                     20.756783
rmsle                     0.171587
```

## h2o.varimp(best_model)

```{r eval = FALSE}
Variable Importances: 
       variable relative_importance scaled_importance percentage
1           day   4812339200.000000          1.000000   0.609602
2           BLH   1090007936.000000          0.226503   0.138076
3  Station_code    531577504.000000          0.110461   0.067337
4        season    501058016.000000          0.104119   0.063471
5           AOD    382592544.000000          0.079502   0.048465
6           CWV    144091856.000000          0.029942   0.018253
7          Temp    120222744.000000          0.024982   0.015229
8            RH     87609296.000000          0.018205   0.011098
9         Press     85807816.000000          0.017831   0.010870
10           WS     53585724.000000          0.011135   0.006788
11           WD     35674576.000000          0.007413   0.004519
12          ELV     28886374.000000          0.006003   0.003659
13         NDVI     20781390.000000          0.004318   0.002632
```

## h2o.scoreHistory(best_model)

```{r eval = FALSE}
Scoring History: 
            timestamp          duration number_of_trees training_rmse training_mae
1 2021-12-18 10:43:36 16 min 17.973 sec               0            NA           NA
2 2021-12-18 10:43:36 16 min 17.984 sec               1      26.05539     18.08149
3 2021-12-18 10:43:36 16 min 17.995 sec               2      27.46995     18.74398
4 2021-12-18 10:43:36 16 min 18.006 sec               3      27.38557     18.25913
5 2021-12-18 10:43:36 16 min 18.017 sec               4      27.83985     17.94385
  training_deviance
1                NA
2         678.88327
3         754.59831
4         749.96962
5         775.05730

---
              timestamp          duration number_of_trees training_rmse training_mae
297 2021-12-18 10:43:40 16 min 21.909 sec             296      20.36524     13.44432
298 2021-12-18 10:43:40 16 min 21.923 sec             297      20.36697     13.44537
299 2021-12-18 10:43:40 16 min 21.938 sec             298      20.36691     13.44775
300 2021-12-18 10:43:40 16 min 21.952 sec             299      20.36729     13.44951
301 2021-12-18 10:43:40 16 min 21.965 sec             300      20.37680     13.45025
302 2021-12-18 10:43:41 16 min 23.105 sec             400      20.29520     13.41614
    training_deviance
297         414.74317
298         414.81366
299         414.81083
300         414.82661
301         415.21392
302         411.89513
```

## cv_models

```{r eval = FALSE}
[[1]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_1 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3889353        13        19
  mean_depth min_leaves max_leaves mean_leaves
1   15.62000        431        463   447.07750


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  428.6684
RMSE:  20.70431
MAE:  13.66404
RMSLE:  0.1641703
Mean Residual Deviance :  428.6684


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  368.2038
RMSE:  19.18864
MAE:  13.47219
RMSLE:  0.1626766
Mean Residual Deviance :  368.2038




[[2]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_2 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3824546        13        21
  mean_depth min_leaves max_leaves mean_leaves
1   15.62000        421        458   438.68000


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  437.2425
RMSE:  20.91034
MAE:  13.6704
RMSLE:  0.1647118
Mean Residual Deviance :  437.2425


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  308.2958
RMSE:  17.55836
MAE:  12.66413
RMSLE:  0.1447997
Mean Residual Deviance :  308.2958




[[3]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_3 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3849008        13        21
  mean_depth min_leaves max_leaves mean_leaves
1   15.51250        426        455   441.18500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  422.6605
RMSE:  20.55871
MAE:  13.65781
RMSLE:  0.1629311
Mean Residual Deviance :  422.6605


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  478.5717
RMSE:  21.87628
MAE:  13.9308
RMSLE:  0.1693852
Mean Residual Deviance :  478.5717




[[4]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_4 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3865463        13        21
  mean_depth min_leaves max_leaves mean_leaves
1   15.54250        429        462   444.33750


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  417.304
RMSE:  20.42802
MAE:  13.60047
RMSLE:  0.1631505
Mean Residual Deviance :  417.304


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  449.2192
RMSE:  21.19479
MAE:  12.97561
RMSLE:  0.1722985
Mean Residual Deviance :  449.2192




[[5]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_5 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3888111        13        20
  mean_depth min_leaves max_leaves mean_leaves
1   15.67500        428        461   445.60750


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  429.8703
RMSE:  20.73331
MAE:  13.64305
RMSLE:  0.1647876
Mean Residual Deviance :  429.8703


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  332.5326
RMSE:  18.23548
MAE:  12.5307
RMSLE:  0.1532276
Mean Residual Deviance :  332.5326




[[6]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_6 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3830464        13        19
  mean_depth min_leaves max_leaves mean_leaves
1   15.54500        424        456   439.29500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  434.3606
RMSE:  20.84132
MAE:  13.69747
RMSLE:  0.1653983
Mean Residual Deviance :  434.3606


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  410.5584
RMSE:  20.26224
MAE:  13.44948
RMSLE:  0.1536466
Mean Residual Deviance :  410.5584




[[7]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_7 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3904384        13        20
  mean_depth min_leaves max_leaves mean_leaves
1   15.53750        431        464   446.37500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  416.9747
RMSE:  20.41996
MAE:  13.50182
RMSLE:  0.1644761
Mean Residual Deviance :  416.9747


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  499.0522
RMSE:  22.33948
MAE:  15.0419
RMSLE:  0.1635698
Mean Residual Deviance :  499.0522




[[8]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_8 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3898845        13        20
  mean_depth min_leaves max_leaves mean_leaves
1   15.71250        430        464   446.51250


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  410.8362
RMSE:  20.2691
MAE:  13.51435
RMSLE:  0.162078
Mean Residual Deviance :  410.8362


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  675.0221
RMSE:  25.98119
MAE:  14.49992
RMSLE:  0.1878454
Mean Residual Deviance :  675.0221




[[9]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_9 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3862194        14        21
  mean_depth min_leaves max_leaves mean_leaves
1   15.67750        426        461   442.54500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  426.5695
RMSE:  20.65356
MAE:  13.58902
RMSLE:  0.1638546
Mean Residual Deviance :  426.5695


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  437.8184
RMSE:  20.92411
MAE:  14.14773
RMSLE:  0.1678752
Mean Residual Deviance :  437.8184




[[10]]
Model Details:
==============

H2ORegressionModel: drf
Model ID:  rf_grid_model_66_cv_10 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             3908207        13        20
  mean_depth min_leaves max_leaves mean_leaves
1   15.69750        430        463   448.76500


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  421.9207
RMSE:  20.54071
MAE:  13.55574
RMSLE:  0.1629635
Mean Residual Deviance :  421.9207


H2ORegressionMetrics: drf
** Reported on validation data. **

MSE:  430.844
RMSE:  20.75678
MAE:  13.88096
RMSLE:  0.1715873
Mean Residual Deviance :  430.844
```

## best_model_perf


```{r eval = FALSE}
H2ORegressionMetrics: drf

MSE:  420.2878
RMSE:  20.50092
MAE:  13.68845
RMSLE:  0.1590127
Mean Residual Deviance :  420.2878
```


## h2o.mse(best_model_perf) %>% sqrt()


```{r eval = FALSE}
20.50
```

## model_drf

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: drf
Model ID:  DRF_model_R_1639803390518_1 
Model Summary: 
  number_of_trees number_of_internal_trees model_size_in_bytes min_depth max_depth
1             400                      400             5842756        15        21
  mean_depth min_leaves max_leaves mean_leaves
1   17.09250        681        719   700.66250


H2ORegressionMetrics: drf
** Reported on training data. **
** Metrics reported on Out-Of-Bag training samples **

MSE:  364.6376
RMSE:  19.09549
MAE:  12.60945
RMSLE:  0.1515452
Mean Residual Deviance :  364.6376



H2ORegressionMetrics: drf
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  377.8872
RMSE:  19.43932
MAE:  12.7506
RMSLE:  0.1536184
Mean Residual Deviance :  377.8872


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     12.747510  0.627372  12.864585  12.300694  13.411721  12.361835
mean_residual_deviance 377.395540 79.453415 397.971950 299.793300 538.677060 323.514000
mse                    377.395540 79.453415 397.971950 299.793300 538.677060 323.514000
r2                       0.936518  0.015047   0.934360   0.949598   0.898995   0.946271
residual_deviance      377.395540 79.453415 397.971950 299.793300 538.677060 323.514000
rmse                    19.336107  1.974975  19.949234  17.314540  23.209417  17.986496
rmsle                    0.153478  0.008841   0.171170   0.148412   0.157942   0.155894
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     12.940369  12.378039  13.065390  12.432472  11.778384
mean_residual_deviance 386.941000 347.900850 379.723360 318.914640 298.778260
mse                    386.941000 347.900850 379.723360 318.914640 298.778260
r2                       0.942646   0.943852   0.932141   0.942914   0.947366
residual_deviance      386.941000 347.900850 379.723360 318.914640 298.778260
rmse                    19.670816  18.652100  19.486492  17.858181  17.285204
rmsle                    0.146263   0.146026   0.164161   0.143948   0.148407
                       cv_10_valid
mae                      13.941612
mean_residual_deviance  481.741120
mse                     481.741120
r2                        0.927042
residual_deviance       481.741120
rmse                     21.948600
rmsle                     0.152553
```

## h2o.varimp(model_drf)

```{r eval = FALSE}
Variable Importances: 
       variable relative_importance scaled_importance percentage
1           day   7177095680.000000          1.000000   0.622225
2           BLH   1452803200.000000          0.202422   0.125952
3        season    829400576.000000          0.115562   0.071906
4  Station_code    767803648.000000          0.106980   0.066565
5           AOD    529303040.000000          0.073749   0.045888
6           CWV    191794176.000000          0.026723   0.016628
7         Press    175581728.000000          0.024464   0.015222
8          Temp    120073472.000000          0.016730   0.010410
9            RH     98038120.000000          0.013660   0.008500
10           WS     68592096.000000          0.009557   0.005947
11           WD     47468872.000000          0.006614   0.004115
12          ELV     44086128.000000          0.006143   0.003822
13         NDVI     32531596.000000          0.004533   0.002820
```

