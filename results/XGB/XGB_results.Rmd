---
title: "XGB"
author: "Adithi R Upadhya"
date: "04/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## xgb_grid_m

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: xgb_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 52 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing residual_deviance
  booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
1    dart         0.70000                  0.59000      poisson 0.02500 0.50000
2  gbtree         0.78000                  0.54000      poisson 0.02500 0.10000
3  gbtree         0.79000                  0.46000        gamma 0.10000 0.05000
4    dart         0.77000                  0.97000        gamma 0.10000 0.10000
5  gbtree         0.24000                  0.20000        gamma 0.02500 0.00010
  grow_policy max_depth min_child_weight min_rows min_split_improvement     ntrees
1   depthwise   4.00000          1.00000  1.00000               0.50000 1199.00000
2   depthwise   8.00000         16.00000 16.00000               0.10000  439.00000
3   depthwise   4.00000          2.00000  2.00000               0.05000 1000.00000
4   depthwise  20.00000          2.00000  2.00000               0.10000 1000.00000
5   depthwise  20.00000          3.00000  3.00000               0.00010 1000.00000
  reg_alpha reg_lambda sample_rate tree_method         model_ids residual_deviance
1   0.00000    0.00100     0.72000       exact xgb_grid_model_45        -879.59153
2   0.10000    0.00100     0.28000       exact xgb_grid_model_48        -813.92595
3   0.00010    0.10000     0.57000       exact xgb_grid_model_22          11.22122
4   0.00100    0.00010     0.45000       exact xgb_grid_model_40          11.22299
5   0.00100    0.00100     0.29000       exact xgb_grid_model_15          11.22335

---
    booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
47   gbtree         0.26000                  0.26000      poisson 0.30000 0.10000
48 gblinear         0.80000                  0.74000      poisson 0.30000 0.10000
49 gblinear         0.79000                  0.96000      poisson 0.05000 0.10000
50 gblinear         0.74000                  0.25000      poisson 0.02500 0.00000
51 gblinear         0.27000                  0.80000      poisson 0.30000 1.00000
52 gblinear         0.80000                  0.92000      poisson 0.30000 0.90000
   grow_policy max_depth min_child_weight   min_rows min_split_improvement     ntrees
47   depthwise   8.00000          3.00000    3.00000               0.10000  500.00000
48   depthwise   4.00000          2.00000    2.00000               0.10000 1000.00000
49   depthwise   8.00000          3.00000    3.00000               0.10000 1500.00000
50   depthwise   6.00000          3.00000    3.00000               0.00000  500.00000
51   depthwise  16.00000       1024.00000 1024.00000               1.00000  500.00000
52   depthwise  16.00000          4.00000    4.00000               0.90000 1000.00000
   reg_alpha reg_lambda sample_rate tree_method         model_ids residual_deviance
47   0.00000    0.00010     0.42000       exact xgb_grid_model_25                NA
48   0.10000    0.00000     0.51000       exact  xgb_grid_model_3                NA
49   1.00000    1.00000     0.96000       exact xgb_grid_model_30                NA
50   0.00100    0.00100     0.35000       exact xgb_grid_model_33                NA
51   0.00100    1.00000     0.42000       exact xgb_grid_model_37                NA
52   0.00010    0.00010     0.24000       exact xgb_grid_model_38                NA
```

## print(grid_perf)

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: xgb_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 52 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing mse
  booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
1  gbtree         0.79000                  0.46000        gamma 0.10000 0.05000
2    dart         0.77000                  0.97000        gamma 0.10000 0.10000
3    dart         0.90000                  0.68000        gamma 0.05000 0.10000
4  gbtree         0.93000                  0.66000     gaussian 0.02500 0.90000
5  gbtree         0.69000                  0.79000        gamma 0.30000 0.10000
  grow_policy max_depth min_child_weight min_rows min_split_improvement     ntrees
1   depthwise   4.00000          2.00000  2.00000               0.05000 1000.00000
2   depthwise  20.00000          2.00000  2.00000               0.10000 1000.00000
3   depthwise  12.00000          2.00000  2.00000               0.10000  500.00000
4   depthwise   6.00000          2.00000  2.00000               0.90000 1000.00000
5   depthwise   8.00000          3.00000  3.00000               0.10000 1500.00000
  reg_alpha reg_lambda sample_rate tree_method         model_ids       mse
1   0.00010    0.10000     0.57000       exact xgb_grid_model_22 471.99835
2   0.00100    0.00010     0.45000       exact xgb_grid_model_40 511.51105
3   0.10000    1.00000     0.81000       exact  xgb_grid_model_2 526.61191
4   0.10000    0.00010     0.94000       exact xgb_grid_model_34 531.34133
5   0.00100    0.00000     1.00000       exact xgb_grid_model_36 539.67608

---
    booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
47   gbtree         0.26000                  0.26000      poisson 0.30000 0.10000
48 gblinear         0.80000                  0.74000      poisson 0.30000 0.10000
49 gblinear         0.79000                  0.96000      poisson 0.05000 0.10000
50 gblinear         0.74000                  0.25000      poisson 0.02500 0.00000
51 gblinear         0.27000                  0.80000      poisson 0.30000 1.00000
52 gblinear         0.80000                  0.92000      poisson 0.30000 0.90000
   grow_policy max_depth min_child_weight   min_rows min_split_improvement     ntrees
47   depthwise   8.00000          3.00000    3.00000               0.10000  500.00000
48   depthwise   4.00000          2.00000    2.00000               0.10000 1000.00000
49   depthwise   8.00000          3.00000    3.00000               0.10000 1500.00000
50   depthwise   6.00000          3.00000    3.00000               0.00000  500.00000
51   depthwise  16.00000       1024.00000 1024.00000               1.00000  500.00000
52   depthwise  16.00000          4.00000    4.00000               0.90000 1000.00000
   reg_alpha reg_lambda sample_rate tree_method         model_ids mse
47   0.00000    0.00010     0.42000       exact xgb_grid_model_25  NA
48   0.10000    0.00000     0.51000       exact  xgb_grid_model_3  NA
49   1.00000    1.00000     0.96000       exact xgb_grid_model_30  NA
50   0.00100    0.00100     0.35000       exact xgb_grid_model_33  NA
51   0.00100    1.00000     0.42000       exact xgb_grid_model_37  NA
52   0.00010    0.00010     0.24000       exact xgb_grid_model_38  NA
```

## best_model

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  157.7712
RMSE:  12.5607
MAE:  8.468348
RMSLE:  0.09353046
Mean Residual Deviance :  11.2025



H2ORegressionMetrics: xgboost
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  471.9984
RMSE:  21.72552
MAE:  14.04007
RMSLE:  0.1650524
Mean Residual Deviance :  11.22122


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     14.033179  0.699328  13.116750  14.493336  13.952243  15.070291
mean_residual_deviance  11.220550  0.049391  11.168370  11.207907  11.242624  11.290440
mse                    473.376160 79.400230 414.748720 487.924130 424.197170 555.262940
r2                       0.918826  0.013204   0.916910   0.917241   0.921637   0.911088
residual_deviance       11.220550  0.049391  11.168370  11.207907  11.242624  11.290440
rmse                    21.691565  1.780199  20.365380  22.089005  20.596046  23.564018
rmsle                    0.164469  0.014417   0.154621   0.176881   0.168804   0.156832
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     13.426982  14.180382  14.213455  13.220190  13.618418
mean_residual_deviance  11.192895  11.281132  11.173849  11.170622  11.194538
mse                    466.676270 458.570000 510.717130 378.483150 397.729920
r2                       0.927054   0.930396   0.914876   0.933223   0.928323
residual_deviance       11.192895  11.281132  11.173849  11.170622  11.194538
rmse                    21.602692  21.414248  22.599052  19.454643  19.943167
rmsle                    0.150536   0.155377   0.195313   0.149622   0.162712
                       cv_10_valid
mae                      15.039748
mean_residual_deviance   11.283123
mse                     639.452150
r2                        0.887512
residual_deviance        11.283123
rmse                     25.287392
rmsle                     0.173998
```

## h2o.varimp(best_model)

```{r eval = FALSE}
Variable Importances: 
  variable relative_importance scaled_importance percentage
1      BLH          794.064941          1.000000   0.181640
2      AOD          683.064148          0.860212   0.156248
3       RH          365.402710          0.460167   0.083585
4    Press          339.626953          0.427707   0.077688
5      CWV          311.548889          0.392347   0.071266

---
           variable relative_importance scaled_importance percentage
226 Station_code.48            0.059002          0.000074   0.000013
227          day.85            0.055527          0.000070   0.000013
228          day.96            0.044331          0.000056   0.000010
229         day.283            0.041850          0.000053   0.000010
230         day.159            0.037212          0.000047   0.000009
231         day.314            0.034887          0.000044   0.000008
```

## h2o.scoreHistory(best_model)

```{r eval = FALSE}
Scoring History: 
            timestamp          duration number_of_trees training_rmse training_mae
1 2021-12-17 22:29:21 58 min 17.893 sec               0     140.35631    117.64853
2 2021-12-17 22:29:21 58 min 17.918 sec              10     139.64478    116.80037
3 2021-12-17 22:29:21 58 min 17.942 sec              20     137.76622    114.56439
4 2021-12-17 22:29:21 58 min 17.962 sec              30     133.03312    108.94973
5 2021-12-17 22:29:21 58 min 17.984 sec              40     122.34536     96.41276
  training_deviance
1         471.20784
2         175.66405
3          68.16345
4          29.78383
5          16.69262

---
              timestamp          duration number_of_trees training_rmse training_mae
96  2021-12-17 22:29:24 58 min 21.478 sec             950      12.75228      8.59878
97  2021-12-17 22:29:24 58 min 21.535 sec             960      12.71871      8.57976
98  2021-12-17 22:29:24 58 min 21.593 sec             970      12.67307      8.54965
99  2021-12-17 22:29:25 58 min 21.648 sec             980      12.64669      8.52887
100 2021-12-17 22:29:25 58 min 21.703 sec             990      12.58007      8.48393
101 2021-12-17 22:29:25 58 min 21.760 sec            1000      12.56070      8.46835
    training_deviance
96           11.20279
97           11.20273
98           11.20266
99           11.20261
100          11.20253
101          11.20250
```

## cv_models


```{r eval = FALSE}
[[1]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_1 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  152.7757
RMSE:  12.36025
MAE:  8.29518
RMSLE:  0.09125837
Mean Residual Deviance :  11.2072


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  414.7487
RMSE:  20.36538
MAE:  13.11675
RMSLE:  0.1546213
Mean Residual Deviance :  11.16837




[[2]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_2 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  153.6608
RMSE:  12.396
MAE:  8.390454
RMSLE:  0.09171001
Mean Residual Deviance :  11.20434


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  487.9241
RMSE:  22.089
MAE:  14.49334
RMSLE:  0.1768808
Mean Residual Deviance :  11.20791




[[3]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_3 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  151.1346
RMSE:  12.29368
MAE:  8.314081
RMSLE:  0.09129477
Mean Residual Deviance :  11.19965


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  424.1972
RMSE:  20.59605
MAE:  13.95224
RMSLE:  0.1688036
Mean Residual Deviance :  11.24262




[[4]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_4 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  147.878
RMSE:  12.16051
MAE:  8.223125
RMSLE:  0.09055783
Mean Residual Deviance :  11.19404


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  555.2629
RMSE:  23.56402
MAE:  15.07029
RMSLE:  0.1568319
Mean Residual Deviance :  11.29044




[[5]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_5 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  154.5607
RMSE:  12.43224
MAE:  8.417189
RMSLE:  0.09220469
Mean Residual Deviance :  11.20474


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  466.6763
RMSE:  21.60269
MAE:  13.42698
RMSLE:  0.1505357
Mean Residual Deviance :  11.19289




[[6]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_6 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  152.5044
RMSE:  12.34927
MAE:  8.352658
RMSLE:  0.09216027
Mean Residual Deviance :  11.19466


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  458.57
RMSE:  21.41425
MAE:  14.18038
RMSLE:  0.1553769
Mean Residual Deviance :  11.28113




[[7]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_7 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  155.1532
RMSE:  12.45605
MAE:  8.454647
RMSLE:  0.09094316
Mean Residual Deviance :  11.20774


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  510.7171
RMSE:  22.59905
MAE:  14.21346
RMSLE:  0.1953131
Mean Residual Deviance :  11.17385




[[8]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_8 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  151.1015
RMSE:  12.29234
MAE:  8.32
RMSLE:  0.09034713
Mean Residual Deviance :  11.20685


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  378.4832
RMSE:  19.45464
MAE:  13.22019
RMSLE:  0.1496219
Mean Residual Deviance :  11.17062




[[9]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_9 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  149.9915
RMSE:  12.2471
MAE:  8.321405
RMSLE:  0.09096226
Mean Residual Deviance :  11.20506


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  397.7299
RMSE:  19.94317
MAE:  13.61842
RMSLE:  0.1627119
Mean Residual Deviance :  11.19454




[[10]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  xgb_grid_model_22_cv_10 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  153.226
RMSE:  12.37845
MAE:  8.380887
RMSLE:  0.09249719
Mean Residual Deviance :  11.19681


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  639.4521
RMSE:  25.28739
MAE:  15.03975
RMSLE:  0.1739978
Mean Residual Deviance :  11.28312

```

## best_model_perf


```{r eval = FALSE}
H2ORegressionMetrics: xgboost

MSE:  504.6867
RMSE:  22.46523
MAE:  14.44989
RMSLE:  0.1624068
Mean Residual Deviance :  11.25328
```


## h2o.mse(best_model_perf) %>% sqrt()


```{r eval = FALSE}
22.465
```

## model_xgb

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  XGBoost_model_R_1639756845470_1 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  172.0091
RMSE:  13.11523
MAE:  8.777418
RMSLE:  0.09620692
Mean Residual Deviance :  11.21262



H2ORegressionMetrics: xgboost
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  412.821
RMSE:  20.318
MAE:  13.34734
RMSLE:  0.1551043
Mean Residual Deviance :  11.2277


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     13.359188  0.764744  12.348084  12.593954  13.641257  14.428199
mean_residual_deviance  11.226914  0.063896  11.243334  11.289529  11.236152  11.302502
mse                    413.565670 59.141468 330.604280 347.283780 489.892360 460.623600
r2                       0.930434  0.010359   0.943963   0.948272   0.919756   0.926715
residual_deviance       11.226914  0.063896  11.243334  11.289529  11.236152  11.302502
rmse                    20.288876  1.463335  18.182528  18.635551  22.133512  21.462143
rmsle                    0.154947  0.005857   0.150877   0.147953   0.155517   0.157851
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     13.634830  12.995937  12.658414  13.945433  12.900315
mean_residual_deviance  11.185092  11.228120  11.101992  11.248956  11.150757
mse                    457.119600 380.414100 361.424380 452.576800 380.329000
r2                       0.917712   0.932520   0.937025   0.919912   0.931836
residual_deviance       11.185092  11.228120  11.101992  11.248956  11.150757
rmse                    21.380356  19.504208  19.011166  21.273853  19.502026
rmsle                    0.164093   0.164350   0.150286   0.152922   0.156522
                       cv_10_valid
mae                      14.445458
mean_residual_deviance   11.282712
mse                     475.388760
r2                        0.926631
residual_deviance        11.282712
rmse                     21.803411
rmsle                     0.149103
```

## h2o.varimp(model_xgb)

```{r eval = FALSE}
Variable Importances: 
  variable relative_importance scaled_importance percentage
1      BLH         1088.399292          1.000000   0.176151
2      AOD          838.794861          0.770668   0.135754
3      CWV          531.139893          0.488001   0.085962
4    Press          502.985626          0.462133   0.081405
5       RH          467.321411          0.429366   0.075633

---
           variable relative_importance scaled_importance percentage
242          day.89            0.083437          0.000077   0.000014
243          day.29            0.061065          0.000056   0.000010
244          day.33            0.058225          0.000053   0.000009
245 Station_code.48            0.052224          0.000048   0.000008
246         day.156            0.045029          0.000041   0.000007
247          day.74            0.031232          0.000029   0.000005
```




