---
title: "LGBM"
author: "Adithi R Upadhya"
date: "04/12/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## lgb_grid_m

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: lgb_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 42 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing residual_deviance
  booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
1  gbtree         0.79000                  0.46000        gamma 0.10000 0.05000
2    dart         0.77000                  0.97000        gamma 0.10000 0.10000
3  gbtree         0.24000                  0.20000        gamma 0.02500 0.00010
4    dart         0.90000                  0.68000        gamma 0.05000 0.10000
5  gbtree         0.69000                  0.79000        gamma 0.30000 0.10000
  grow_policy max_depth min_child_weight min_rows min_split_improvement     ntrees
1   lossguide   4.00000          2.00000  2.00000               0.05000 1000.00000
2   lossguide  20.00000          2.00000  2.00000               0.10000 1000.00000
3   lossguide  20.00000          3.00000  3.00000               0.00010 1000.00000
4   lossguide  12.00000          2.00000  2.00000               0.10000  500.00000
5   lossguide   8.00000          3.00000  3.00000               0.10000 1500.00000
  reg_alpha reg_lambda sample_rate tree_method         model_ids residual_deviance
1   0.00010    0.10000     0.57000        hist lgb_grid_model_22          11.22060
2   0.00100    0.00010     0.45000        hist lgb_grid_model_40          11.22340
3   0.00100    0.00100     0.29000        hist lgb_grid_model_15          11.22340
4   0.10000    1.00000     0.81000        hist  lgb_grid_model_2          11.22342
5   0.00100    0.00000     1.00000        hist lgb_grid_model_36          11.22535

---
    booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
37 gblinear         0.80000                  0.74000      poisson 0.30000 0.10000
38 gblinear         0.79000                  0.96000      poisson 0.05000 0.10000
39 gblinear         0.74000                  0.25000      poisson 0.02500 0.00000
40 gblinear         0.27000                  0.80000      poisson 0.30000 1.00000
41 gblinear         0.80000                  0.92000      poisson 0.30000 0.90000
42     dart         0.67000                  0.95000      poisson 0.10000 0.50000
   grow_policy max_depth min_child_weight   min_rows min_split_improvement     ntrees
37   lossguide   4.00000          2.00000    2.00000               0.10000 1000.00000
38   lossguide   8.00000          3.00000    3.00000               0.10000 1500.00000
39   lossguide   6.00000          3.00000    3.00000               0.00000  500.00000
40   lossguide  16.00000       1024.00000 1024.00000               1.00000  500.00000
41   lossguide  16.00000          4.00000    4.00000               0.90000 1000.00000
42   lossguide  16.00000          2.00000    2.00000               0.50000  500.00000
   reg_alpha reg_lambda sample_rate tree_method         model_ids residual_deviance
37   0.10000    0.00000     0.51000        hist  lgb_grid_model_3                NA
38   1.00000    1.00000     0.96000        hist lgb_grid_model_30                NA
39   0.00100    0.00100     0.35000        hist lgb_grid_model_33                NA
40   0.00100    1.00000     0.42000        hist lgb_grid_model_37                NA
41   0.00010    0.00010     0.24000        hist lgb_grid_model_38                NA
42   0.00100    0.10000     0.80000        hist  lgb_grid_model_4                NA
```

## print(grid_perf)

```{r eval = FALSE}
H2O Grid Details
================

Grid ID: lgb_grid 
Used hyper parameters: 
  -  booster 
  -  col_sample_rate 
  -  col_sample_rate_per_tree 
  -  distribution 
  -  eta 
  -  gamma 
  -  grow_policy 
  -  max_depth 
  -  min_child_weight 
  -  min_rows 
  -  min_split_improvement 
  -  ntrees 
  -  reg_alpha 
  -  reg_lambda 
  -  sample_rate 
  -  tree_method 
Number of models: 42 
Number of failed models: 0 

Hyper-Parameter Search Summary: ordered by increasing mse
  booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
1  gbtree         0.79000                  0.46000        gamma 0.10000 0.05000
2    dart         0.77000                  0.97000        gamma 0.10000 0.10000
3  gbtree         0.93000                  0.66000     gaussian 0.02500 0.90000
4  gbtree         0.55000                  0.33000     gaussian 0.02500 0.10000
5    dart         0.90000                  0.68000        gamma 0.05000 0.10000
  grow_policy max_depth min_child_weight min_rows min_split_improvement     ntrees
1   lossguide   4.00000          2.00000  2.00000               0.05000 1000.00000
2   lossguide  20.00000          2.00000  2.00000               0.10000 1000.00000
3   lossguide   6.00000          2.00000  2.00000               0.90000 1000.00000
4   lossguide  16.00000          2.00000  2.00000               0.10000 1000.00000
5   lossguide  12.00000          2.00000  2.00000               0.10000  500.00000
  reg_alpha reg_lambda sample_rate tree_method         model_ids       mse
1   0.00010    0.10000     0.57000        hist lgb_grid_model_22 456.74377
2   0.00100    0.00010     0.45000        hist lgb_grid_model_40 516.20585
3   0.10000    0.00010     0.94000        hist lgb_grid_model_34 516.36217
4   0.00100    1.00000     1.00000        hist lgb_grid_model_32 517.92425
5   0.10000    1.00000     0.81000        hist  lgb_grid_model_2 530.24014

---
    booster col_sample_rate col_sample_rate_per_tree distribution     eta   gamma
37 gblinear         0.80000                  0.74000      poisson 0.30000 0.10000
38 gblinear         0.79000                  0.96000      poisson 0.05000 0.10000
39 gblinear         0.74000                  0.25000      poisson 0.02500 0.00000
40 gblinear         0.27000                  0.80000      poisson 0.30000 1.00000
41 gblinear         0.80000                  0.92000      poisson 0.30000 0.90000
42     dart         0.67000                  0.95000      poisson 0.10000 0.50000
   grow_policy max_depth min_child_weight   min_rows min_split_improvement     ntrees
37   lossguide   4.00000          2.00000    2.00000               0.10000 1000.00000
38   lossguide   8.00000          3.00000    3.00000               0.10000 1500.00000
39   lossguide   6.00000          3.00000    3.00000               0.00000  500.00000
40   lossguide  16.00000       1024.00000 1024.00000               1.00000  500.00000
41   lossguide  16.00000          4.00000    4.00000               0.90000 1000.00000
42   lossguide  16.00000          2.00000    2.00000               0.50000  500.00000
   reg_alpha reg_lambda sample_rate tree_method         model_ids mse
37   0.10000    0.00000     0.51000        hist  lgb_grid_model_3  NA
38   1.00000    1.00000     0.96000        hist lgb_grid_model_30  NA
39   0.00100    0.00100     0.35000        hist lgb_grid_model_33  NA
40   0.00100    1.00000     0.42000        hist lgb_grid_model_37  NA
41   0.00010    0.00010     0.24000        hist lgb_grid_model_38  NA
42   0.00100    0.10000     0.80000        hist  lgb_grid_model_4  NA
```

## best_model

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  162.9696
RMSE:  12.76596
MAE:  8.560533
RMSLE:  0.09493511
Mean Residual Deviance :  11.20278



H2ORegressionMetrics: xgboost
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  456.7438
RMSE:  21.37156
MAE:  13.81673
RMSLE:  0.1633341
Mean Residual Deviance :  11.2206


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     13.804009  0.618549  12.517337  13.910641  14.179309  14.260604
mean_residual_deviance  11.219920  0.049151  11.167237  11.206397  11.243350  11.288182
mse                    457.479500 61.141045 389.167600 443.098000 450.936580 492.813300
r2                       0.921602  0.009582   0.922034   0.924844   0.916698   0.921088
residual_deviance       11.219920  0.049151  11.167237  11.206397  11.243350  11.288182
rmse                    21.346397  1.418455  19.727331  21.049892  21.235268  22.199398
rmsle                    0.162686  0.014369   0.151037   0.172729   0.170901   0.150794
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     13.440780  14.457811  14.395952  13.338256  13.383602
mean_residual_deviance  11.192337  11.281855  11.173231  11.171153  11.194221
mse                    473.459350 492.532500 480.498000 373.773560 398.596500
r2                       0.925994   0.925241   0.919913   0.934054   0.928167
residual_deviance       11.192337  11.281855  11.173231  11.171153  11.194221
rmse                    21.759120  22.193073  21.920263  19.333223  19.964882
rmsle                    0.147675   0.158108   0.194086   0.150668   0.162185
                       cv_10_valid
mae                      14.155791
mean_residual_deviance   11.281241
mse                     579.919740
r2                        0.897985
residual_deviance        11.281241
rmse                     24.081522
rmsle                     0.168675
```

## h2o.varimp(best_model)

```{r eval = FALSE}
Variable Importances: 
  variable relative_importance scaled_importance percentage
1      BLH          727.753784          1.000000   0.166013
2      AOD          637.268738          0.875665   0.145372
3     Temp          407.828613          0.560394   0.093033
4      CWV          366.338440          0.503382   0.083568
5    Press          319.910278          0.439586   0.072977

---
    variable relative_importance scaled_importance percentage
231  day.114            0.052916          0.000073   0.000012
232  day.336            0.048637          0.000067   0.000011
233   day.33            0.046144          0.000063   0.000011
234  day.255            0.040736          0.000056   0.000009
235  day.289            0.037526          0.000052   0.000009
236  day.110            0.036554          0.000050   0.000008
```

## h2o.scoreHistory(best_model)

```{r eval = FALSE}
Scoring History: 
            timestamp          duration number_of_trees training_rmse training_mae
1 2021-12-18 00:21:04 55 min 59.206 sec               0     140.35631    117.64853
2 2021-12-18 00:21:04 55 min 59.229 sec              10     139.64476    116.80016
3 2021-12-18 00:21:04 55 min 59.241 sec              20     137.76608    114.56395
4 2021-12-18 00:21:04 55 min 59.255 sec              30     133.03366    108.94486
5 2021-12-18 00:21:04 55 min 59.269 sec              40     122.34279     96.41234
  training_deviance
1         471.20784
2         175.65984
3          68.16031
4          29.78392
5          16.69074

---
              timestamp          duration number_of_trees training_rmse training_mae
96  2021-12-18 00:21:07 56 min  2.133 sec             950      12.97644      8.69972
97  2021-12-18 00:21:07 56 min  2.192 sec             960      12.94361      8.67361
98  2021-12-18 00:21:07 56 min  2.242 sec             970      12.91516      8.65567
99  2021-12-18 00:21:07 56 min  2.291 sec             980      12.85427      8.61322
100 2021-12-18 00:21:07 56 min  2.341 sec             990      12.80018      8.58698
101 2021-12-18 00:21:08 56 min  2.391 sec            1000      12.76596      8.56053
    training_deviance
96           11.20312
97           11.20304
98           11.20300
99           11.20293
100          11.20285
101          11.20278
```

## cv_models

```{r eval = FALSE}
[[1]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_1 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  167.5585
RMSE:  12.94444
MAE:  8.754194
RMSLE:  0.09645658
Mean Residual Deviance :  11.20817


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  389.1676
RMSE:  19.72733
MAE:  12.51734
RMSLE:  0.1510366
Mean Residual Deviance :  11.16724




[[2]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_2 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  159.4081
RMSE:  12.62569
MAE:  8.583444
RMSLE:  0.0942731
Mean Residual Deviance :  11.2048


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  443.098
RMSE:  21.04989
MAE:  13.91064
RMSLE:  0.1727293
Mean Residual Deviance :  11.2064




[[3]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_3 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  163.2791
RMSE:  12.77807
MAE:  8.593996
RMSLE:  0.09419664
Mean Residual Deviance :  11.20018


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  450.9366
RMSE:  21.23527
MAE:  14.17931
RMSLE:  0.1709012
Mean Residual Deviance :  11.24335




[[4]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_4 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  159.4736
RMSE:  12.62828
MAE:  8.549217
RMSLE:  0.09415387
Mean Residual Deviance :  11.19468


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  492.8133
RMSE:  22.1994
MAE:  14.2606
RMSLE:  0.150794
Mean Residual Deviance :  11.28818




[[5]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_5 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  163.6007
RMSE:  12.79065
MAE:  8.711221
RMSLE:  0.09531381
Mean Residual Deviance :  11.20534


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  473.4593
RMSE:  21.75912
MAE:  13.44078
RMSLE:  0.1476749
Mean Residual Deviance :  11.19234




[[6]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_6 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  159.0776
RMSE:  12.6126
MAE:  8.482319
RMSLE:  0.09440364
Mean Residual Deviance :  11.19504


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  492.5325
RMSE:  22.19307
MAE:  14.45781
RMSLE:  0.1581081
Mean Residual Deviance :  11.28185




[[7]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_7 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  162.9847
RMSE:  12.76655
MAE:  8.673149
RMSLE:  0.09427098
Mean Residual Deviance :  11.20836


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  480.498
RMSE:  21.92026
MAE:  14.39595
RMSLE:  0.1940857
Mean Residual Deviance :  11.17323




[[8]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_8 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  166.3502
RMSE:  12.89768
MAE:  8.70873
RMSLE:  0.0960697
Mean Residual Deviance :  11.20793


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  373.7735
RMSE:  19.33322
MAE:  13.33826
RMSLE:  0.1506677
Mean Residual Deviance :  11.17115




[[9]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_9 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  159.1926
RMSE:  12.61716
MAE:  8.576319
RMSLE:  0.0940386
Mean Residual Deviance :  11.20562


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  398.5965
RMSE:  19.96488
MAE:  13.3836
RMSLE:  0.1621849
Mean Residual Deviance :  11.19422




[[10]]
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  lgb_grid_model_22_cv_10 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  165.3742
RMSE:  12.85979
MAE:  8.562587
RMSLE:  0.09515304
Mean Residual Deviance :  11.19729


H2ORegressionMetrics: xgboost
** Reported on validation data. **

MSE:  579.9197
RMSE:  24.08152
MAE:  14.15579
RMSLE:  0.1686752
Mean Residual Deviance :  11.28124
```

## best_model_perf


```{r eval = FALSE}
H2ORegressionMetrics: xgboost

MSE:  492.851
RMSE:  22.20025
MAE:  14.44269
RMSLE:  0.1602908
Mean Residual Deviance :  11.25213
```


## h2o.mse(best_model_perf) %>% sqrt()


```{r eval = FALSE}
22.2
```

## model_lgb

```{r eval = FALSE}
Model Details:
==============

H2ORegressionModel: xgboost
Model ID:  XGBoost_model_R_1639763669651_1 
Model Summary: 
  number_of_trees
1            1000


H2ORegressionMetrics: xgboost
** Reported on training data. **

MSE:  183.4787
RMSE:  13.54543
MAE:  9.045726
RMSLE:  0.09936002
Mean Residual Deviance :  11.21322



H2ORegressionMetrics: xgboost
** Reported on cross-validation data. **
** 10-fold cross-validation on training data (Metrics computed for combined holdout predictions) **

MSE:  408.0295
RMSE:  20.19974
MAE:  13.24341
RMSLE:  0.1535726
Mean Residual Deviance :  11.22719


Cross-Validation Metrics Summary: 
                             mean        sd cv_1_valid cv_2_valid cv_3_valid cv_4_valid
mae                     13.253414  0.848627  12.325696  12.454924  13.993827  14.235712
mean_residual_deviance  11.226399  0.064212  11.242674  11.288456  11.235558  11.301356
mse                    409.445500 68.460570 333.891660 336.491550 483.883480 442.896200
r2                       0.931223  0.011048   0.943406   0.949880   0.920741   0.929535
residual_deviance       11.226399  0.064212  11.242674  11.288456  11.235558  11.301356
rmse                    20.172136  1.676776  18.272703  18.343706  21.997353  21.045100
rmsle                    0.153355  0.007100   0.146940   0.142976   0.153891   0.154680
                       cv_5_valid cv_6_valid cv_7_valid cv_8_valid cv_9_valid
mae                     13.003510  12.733501  12.674425  13.661238  12.679277
mean_residual_deviance  11.183208  11.228848  11.100985  11.249696  11.149688
mse                    457.480700 347.996520 371.993740 432.624970 359.529850
r2                       0.917647   0.938271   0.935183   0.923443   0.935563
residual_deviance       11.183208  11.228848  11.100985  11.249696  11.149688
rmse                    21.388798  18.654665  19.287140  20.799639  18.961271
rmsle                    0.159562   0.168254   0.147235   0.154849   0.153417
                       cv_10_valid
mae                      14.772033
mean_residual_deviance   11.283524
mse                     527.666300
r2                        0.918562
residual_deviance        11.283524
rmse                     22.970990
rmsle                     0.151744
```

## h2o.varimp(model_lgb)

```{r eval = FALSE}
Variable Importances: 
  variable relative_importance scaled_importance percentage
1      BLH         1320.473022          1.000000   0.214516
2      AOD          817.333740          0.618970   0.132779
3    Press          568.027588          0.430170   0.092278
4      CWV          484.099121          0.366610   0.078644
5     Temp          399.397400          0.302465   0.064884

---
    variable relative_importance scaled_importance percentage
248   day.86            0.051629          0.000039   0.000008
249  day.159            0.051261          0.000039   0.000008
250    day.7            0.051052          0.000039   0.000008
251  day.296            0.045053          0.000034   0.000007
252   day.85            0.041753          0.000032   0.000007
253  day.110            0.028974          0.000022   0.000005
```

